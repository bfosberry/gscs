<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="GSCS : Game Server Container Specification">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>GSCS</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/bfosberry/gscs">View on GitHub</a>

          <h1 id="project_title">GSCS</h1>
          <h2 id="project_tagline">Game Server Container Specification</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/bfosberry/gscs/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/bfosberry/gscs/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>Running a game server inside a linux container is not an easy task. This specification is aimed at standardizing game server containers to both simplify the process of containerizing a game server, and also increase compatibility between different containers. </p>

<table>
<thead>
<tr>
<th>Version History</th>
<th>Updated At</th>
</tr>
</thead>
<tbody>
<tr>
<td>v0.1</td>
<td>3/16/15</td>
</tr>
</tbody>
</table>

<h2>
<a id="getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting Started</h2>

<p>This specification aims to be simple, and pluggable. A game server consists of a number of the components, the game server itself, a metadata file as part of the game server repository, a controller, a storage component, and watcher component. According to best practices, each component of a game server should be split into a different repository, with the primary game server residing within the main repo, although this is not enforced. Each component should be single purpose, with the main repo only serving the game server itself.</p>

<h2>
<a id="metadata" class="anchor" href="#metadata" aria-hidden="true"><span class="octicon octicon-link"></span></a>Metadata</h2>

<p>The metadata documents how the game server is created, executed, configured, controlled and viewed. The file must adhere to a json schema, to make it easy to consume by both individual users an pluggable systems. For a more detailed overview of the metadata file, it's components, and how to create one, view the <a href="metadata">metadata documentation</a></p>

<h2>
<a id="storage" class="anchor" href="#storage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Storage</h2>

<p>Primarily containers are meant to be ephemeral, meaning you run them once, and delete them. In order to adhere to best practices, instead of having a container that is started, stopped, and restarted over a long period of time, the persisted components of the application are extracted to a data container. This is achieved through volume mounting, mapping a directory containing <em>ONLY</em> persisted data between the game server container and the data container. The data container must be started first, and then the game server started with the <code>--volumes-from data-container</code> type flag. This allows the game server container to be destroyed and re-created without losing any data. </p>

<p>A data container should have the same base image as the game server itself, however should need no scripts, applications or configuration. It exists purely to be a lightweight volume provider, and spends most of its time in a stopped state.</p>

<p>Here is an example of a <a href="https://github.com/bfosberry/gamekick_storage">simple data container</a></p>

<h2>
<a id="main-repo" class="anchor" href="#main-repo" aria-hidden="true"><span class="octicon octicon-link"></span></a>Main Repo</h2>

<p>The game server repository is the most complex component. This should be responsible for;</p>

<ul>
<li>building the game server image through a Dockerfile</li>
<li>pulling down configuration </li>
<li>prepping directory structure and ownership</li>
<li>writing any scripts and config files</li>
<li>executing the game server </li>
</ul>

<p>These components should execute in series, with the game server being the last component executed. The container should only remain running while the game server is still running, this allows the orchestration platform to decide what action to take should the game server stop, as well as directly control the process and send signals to it. Most of the steps for creating the main game server repo involve implementing the metadata definition.</p>

<h3>
<a id="dockerfile" class="anchor" href="#dockerfile" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dockerfile</h3>

<p>Find which linux distro is most supported or most efficient for your game server a stick with it. <code>ubuntu</code> is a safe bet since it is well supported.</p>

<pre><code>FROM ubuntu
</code></pre>

<p>Next you may need to install certain libraries, depending on the server:</p>

<pre><code>RUN sudo apt-get update &amp;&amp; sudo apt-get -y install lib32gcc1 lib32z1 lib32ncurses5 lib32bz2-1.0 lib32stdc++6 gdb
</code></pre>

<p>Download your game server itself:</p>

<pre><code># install teamspeak
ENV TS3_VERSION 3.0.11.1
ENV TS3_DIR /opt/teamspeak3-server
RUN wget -O /tmp/teamspeak-server.tar.gz http://dl.4players.de/ts/releases/$TS3_VERSION/teamspeak3-server_linux-amd64-$TS3_VERSION.tar.gz
RUN tar -xf /tmp/teamspeak-server.tar.gz -C /opt &amp;&amp; mv /opt/teamspeak3-server_linux-amd64 $TS3_DIR
</code></pre>

<p>Define one, or several, mount points. There can be an overlap with your storage container volumes, these define the folders provided to the controller and watcher. Persisted data will be stored in the volumes-from the data container, however should any further non-persisted state information, such as logs, need to be provided to the controller or watcher, it must be defined as a volume. The game server should also define a volume for the persisted state so the watcher and controller do not also need to mount volumes from the storage container separately. </p>

<pre><code>VOLUME /opt/data
VOLUME /opt/logs
</code></pre>

<p>Expose any ports your game server uses, this helps port discovery in some cases. </p>

<pre><code># expose the teamspeak ports
EXPOSE 9987/udp
EXPOSE 10011
EXPOSE 30033
</code></pre>

<p>Define an entrypoint as a script or command that executes the steps required to launch the game server:</p>

<pre><code>ENTRYPOINT ["/opt/scripts/run"]
</code></pre>

<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h2>

<h2>
<a id="controller" class="anchor" href="#controller" aria-hidden="true"><span class="octicon octicon-link"></span></a>Controller</h2>

<h2>
<a id="watcher" class="anchor" href="#watcher" aria-hidden="true"><span class="octicon octicon-link"></span></a>Watcher</h2>

<h2>
<a id="example-repos" class="anchor" href="#example-repos" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example repos</h2>

<ul>
<li><a href="https://github.com/bfosberry/gmod_server">Garry's Mod</a></li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">GSCS maintained by <a href="https://github.com/bfosberry">bfosberry</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-60792926-2");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
